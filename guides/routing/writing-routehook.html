<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Writing a Route Hook | Bernard Docs</title>
    <meta name="description" content="Evaluating VuePress for Birchbox">
    
    
    <link rel="preload" href="/birchbox-vuepress/assets/css/0.styles.857ea5f3.css" as="style"><link rel="preload" href="/birchbox-vuepress/assets/js/app.a6b284a8.js" as="script"><link rel="preload" href="/birchbox-vuepress/assets/js/100.e3eed064.js" as="script"><link rel="prefetch" href="/birchbox-vuepress/assets/js/10.d536d441.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/101.5376d96b.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/102.868789ed.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/103.b26899b9.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/104.5db79103.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/105.e5fe62d2.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/106.abc6926b.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/107.efa45c8f.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/108.3c8f7c70.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/109.37f9c620.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/11.7c95747f.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/110.798856e4.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/111.0a125a53.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/112.9703c050.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/113.95eb6608.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/114.1093d492.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/115.5bfc9bb9.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/116.3cc5b278.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/117.4ee1790b.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/118.e5611d74.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/119.d801e1c8.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/12.8cef179e.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/120.86d0b8bd.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/121.9550fa71.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/13.cffe586c.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/14.709bdaea.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/15.2ba242d8.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/16.3e254ad7.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/17.a0970d0e.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/18.81232a83.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/19.0718734b.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/2.afe850ac.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/20.07873c92.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/21.373d67cc.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/22.94c8eb67.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/23.82424130.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/24.2e2e1768.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/25.a0e7265d.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/26.a8d8c490.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/27.87a06732.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/28.7520adc2.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/29.e4164a50.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/3.5f102d8c.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/30.0c194aaa.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/31.23d342c7.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/32.9131fe12.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/33.a4fdb389.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/34.1a5c10c5.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/35.ccbb7573.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/36.063acf6c.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/37.3c1d6aff.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/38.c464e236.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/39.79fd2668.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/4.0d731df7.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/40.ea261179.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/41.9ed154e3.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/42.1c6347e3.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/43.6fdc5b55.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/44.3104b0a3.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/45.3aaa6d10.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/46.00d448c3.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/47.195eef7f.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/48.2c055462.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/49.e2c7a351.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/5.0c52544e.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/50.4c1236a0.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/51.a9ab44f7.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/52.15f01429.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/53.f41e8f9d.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/54.f34aa305.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/55.904226fc.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/56.6ee97fc3.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/57.b2912456.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/58.ec4cf578.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/59.0ab6ee02.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/6.65bbad91.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/60.609a5462.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/61.715c841a.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/62.e420d91d.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/63.7257c08f.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/64.c65b3c1d.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/65.6892f357.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/66.886d9933.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/67.b18995d9.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/68.16b5ca46.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/69.1afdf6eb.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/7.5e80c419.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/70.79c806d7.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/71.0df6bbe2.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/72.85a5c675.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/73.ef7b90f9.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/74.1a376dd6.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/75.2074a840.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/76.bdfb2ca4.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/77.269ab2c0.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/78.a66c28ef.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/79.da1586fb.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/8.5838ada6.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/80.5283a3ff.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/81.ca7a60dd.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/82.52c2e08c.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/83.a06e6195.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/84.b803f53d.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/85.16f36486.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/86.2cc56122.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/87.3f8dfa11.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/88.effde8f2.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/89.ec412667.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/9.f208e5aa.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/90.ea7fab1e.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/91.82ddbcf2.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/92.c74ca7ec.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/93.326eb4f3.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/94.02c4ff59.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/95.6d30da62.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/96.94d236d9.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/97.3204ce1e.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/98.df2ed029.js"><link rel="prefetch" href="/birchbox-vuepress/assets/js/99.86b83b59.js">
    <link rel="stylesheet" href="/birchbox-vuepress/assets/css/0.styles.857ea5f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/birchbox-vuepress/" class="home-link router-link-active"><!----> <span class="site-name">Bernard Docs</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/zakness/birchbox-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"> <a href="https://github.com/zakness/birchbox-vuepress" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/birchbox-vuepress/" class="sidebar-link">Docs</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Guides</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Components</span> <span class="arrow right"></span></p> <!----></div></li><li><a href="/birchbox-vuepress/enhancers/" class="sidebar-link">Enhancers</a></li><li><a href="/birchbox-vuepress/middleware/" class="sidebar-link">Middleware</a></li><li><a href="/birchbox-vuepress/utils/" class="sidebar-link">Utils</a></li></ul> </div> <div class="page"> <div class="content"><p><a href="/guides/routing">← Routing docs</a></p> <h1 id="writing-a-route-hook"><a href="#writing-a-route-hook" aria-hidden="true" class="header-anchor">#</a> Writing a Route Hook</h1> <p>In this document we’ll be building the <a href="/src/components/RouteHooks/ProductViewLoader.js"><code>&lt;ProductViewLoader&gt;</code></a> route hook from scratch to demonstrate the following concepts:</p> <ul><li>Loading the primary view-specific data before the view mounts (and showing <a href="/src/components/PageNotFound/index.js"><code>&lt;PageNotFound&gt;</code></a> if it fails)</li> <li>Updating <a href="/birchbox-vuepress/guides/routing/redux-state.html#routernext"><code>router.next</code></a> after the route matches but before the view mounts</li> <li>Adding view-specific params to the <code>page-view</code> logging event</li></ul> <p>We’ll use the desire to simplify <a href="/src/views/catalog/ProductView/index.js"><code>&lt;ProductView&gt;</code></a> specifically as the motivation for building <code>&lt;ProductViewLoader&gt;</code>.</p> <h2 id="loading-view-specific-data"><a href="#loading-view-specific-data" aria-hidden="true" class="header-anchor">#</a> Loading view-specific data</h2> <p>One way <code>&lt;ProductView&gt;</code> can be simplified is to remove the logic for changing the UI vertical based on the product data. This means the product data needs to be downloaded before the View mounts. Here’s a first pass where all <code>&lt;ProductViewLoader&gt;</code> does is load the product and pass it to <code>&lt;ProductView&gt;</code>:</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ViewRoute</span> <span class="token attr-name">path</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token constant">URLS</span><span class="token punctuation">.</span><span class="token function">product</span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">pageType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>pdp<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProductViewLoader</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PageViewDispatcher</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProductView</span> <span class="token attr-name">product</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>product<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PageViewDispatcher</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    }
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ProductViewLoader</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ViewRoute</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></code></pre></div><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> loadProduct <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'data/catalog'</span>

<span class="token keyword">const</span> <span class="token function-variable function">ProductViewLoader</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> product<span class="token punctuation">,</span> children<span class="token punctuation">,</span> status <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> status <span class="token operator">===</span> <span class="token constant">STATUS</span><span class="token punctuation">.</span><span class="token constant">READY</span>
    <span class="token operator">?</span> <span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">{</span> product <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token punctuation">/&gt;</span></span>
<span class="token punctuation">}</span>

ProductViewLoader<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> PromiseLoader<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>input<span class="token punctuation">.</span>number<span class="token punctuation">,</span>
  product<span class="token punctuation">:</span> PromiseLoader<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>output<span class="token punctuation">.</span>product<span class="token punctuation">,</span>
  status<span class="token punctuation">:</span> CustomPropTypes<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

ProductViewLoader<span class="token punctuation">.</span><span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> router <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>next <span class="token operator">||</span> router<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`match.params.id`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

ProductViewLoader<span class="token punctuation">.</span><span class="token function-variable function">loadPromisedProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">loadProduct</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> product <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>PromiseLoader<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>ProductViewLoader<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Notice that we don’t render <code>children</code> until we have a <code>product</code> object. This keeps <code>&lt;ProductView&gt;</code> simple, as it doesn’t have to check the prop — it will always be a real product.</p> <p>Also take a look at the <code>id</code> prop in <code>mapStateToProps</code>. Since <code>&lt;ProductViewLoader&gt;</code> is a route hook, it’s mounted after <code>VIEW_ROUTE_MATCH</code> dispatches but before <code>PAGE_VIEW</code>, so it needs to initially get the <code>id</code> from <code>router.next</code>. Then, after <code>PAGE_VIEW</code> dispatches it re-renders, so it needs to get the <code>id</code> from <code>router</code>.</p> <h2 id="updating-router-next"><a href="#updating-router-next" aria-hidden="true" class="header-anchor">#</a> Updating <code>router.next</code></h2> <p>Now let’s actually handle updating the vertical:</p> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token inserted">+   import { loadProduct } from 'data/catalog'</span>
<span class="token inserted">+ import { viewRouteUpdate } from 'actions/router'</span>

  const ProductViewLoader = ({ product, children, status }) =&gt; {
    return status === STATUS.READY
      ? children({ product })
      : &lt;div /&gt;
  }

  ProductViewLoader.propTypes = {
    id: PromiseLoader.PropTypes.input.number,
    product: PromiseLoader.PropTypes.output.product,
    status: CustomPropTypes.status,
<span class="token inserted">+   uiVertical: CustomPropTypes.vertical,</span>
  }

<span class="token deleted">- ProductViewLoader.mapStateToProps = ({ router }) =&gt; ({</span>
<span class="token inserted">+ ProductViewLoader.mapStateToProps = ({ router, ui }) =&gt; ({</span>
    id: Number(_.get(router.next || router, `match.params.id`)),
<span class="token inserted">+   uiVertical: ui.vertical,</span>
  })

<span class="token inserted">+ ProductViewLoader.mapDispatchToProps = {</span>
<span class="token inserted">+   viewRouteUpdate,</span>
<span class="token inserted">+ }</span>

  ProductViewLoader.loadPromisedProps = (props) =&gt;
    loadProduct(props.id).then((product) =&gt; {
<span class="token inserted">+     const vertical = product.isUnisex ? props.uiVertical : product.vertical</span>
<span class="token inserted">+     props.uiVertical !== vertical &amp;&amp; props.viewRouteUpdate({ vertical })</span>
      return { product }
    })

  export default connect(PromiseLoader.compose(ProductViewLoader))
</code></pre></div><p>Here we introduce the <code>viewRouteUpdate</code> action which dispatches <code>VIEW_ROUTE_UPDATE</code>. As you might imagine, it takes a partial <code>view</code> object and merges it into the current <code>router.next.view</code> state. This is how navigation event data can be updated asynchronously.</p> <h2 id="adding-page-view-logging-params"><a href="#adding-page-view-logging-params" aria-hidden="true" class="header-anchor">#</a> Adding <code>page-view</code> logging params</h2> <p>Next we have a requirement to attach product-specific data to the <code>page-view</code> logging event that fires when the user views the PDP. We do this by passing <code>logParams</code> to <a href="/birchbox-vuepress/components/PageViewDispatcher.html"><code>&lt;PageViewDispatcher&gt;</code></a>:</p> <div class="language-diff extra-class"><pre class="language-diff"><code>  &lt;ViewRoute path={URLS.product(':id')} pageType='pdp'&gt;
    &lt;ProductViewLoader&gt;
<span class="token deleted">-     {({ product }) =&gt;</span>
<span class="token inserted">+     {({ product, logParams }) =&gt;</span>
<span class="token deleted">-       &lt;PageViewDispatcher&gt;</span>
<span class="token inserted">+       &lt;PageViewDispatcher logParams={logParams}&gt;</span>
          &lt;ProductView product={product}&gt;
        &lt;/PageViewDispatcher&gt;
      }
    &lt;/ProductViewLoader&gt;
  &lt;/ViewRoute&gt;
</code></pre></div><div class="language-diff extra-class"><pre class="language-diff"><code>  ...

  const ProductViewLoader = ({ product, children, status }) =&gt; {
<span class="token inserted">+   const logParams = product</span>
<span class="token inserted">+     ? {</span>
<span class="token inserted">+       productId: String(product.id),</span>
<span class="token inserted">+       brandId: String(product.brandId),</span>
<span class="token inserted">+       brandName: product.brandName,</span>
<span class="token inserted">+       title: product.title,</span>
<span class="token inserted">+     }</span>
<span class="token inserted">+     : undefined</span>
    return status === STATUS.READY
<span class="token deleted">-     ? children({ product })</span>
<span class="token inserted">+     ? children({ product, logParams })</span>
      : &lt;div /&gt;
  }

  ...
</code></pre></div><h2 id="rendering-pagenotfound-for-bad-data"><a href="#rendering-pagenotfound-for-bad-data" aria-hidden="true" class="header-anchor">#</a> Rendering <code>&lt;PageNotFound&gt;</code> for bad data</h2> <p>It is possible for users to type a bogus pid in the URL, which would cause the <code>loadProduct</code> call to throw an error. If this happens we want to show <code>&lt;PageNotFound&gt;</code>:</p> <div class="language-diff extra-class"><pre class="language-diff"><code>  &lt;ViewRoute path={URLS.product(':id')} pageType='pdp'&gt;
    &lt;ProductViewLoader&gt;
      {({ product, logParams }) =&gt;
        &lt;PageViewDispatcher logParams={logParams}&gt;
<span class="token deleted">-         &lt;ProductView product={product}&gt;</span>
<span class="token inserted">+         {product</span>
<span class="token inserted">+           ? &lt;ProductView product={product} /&gt;</span>
<span class="token inserted">+           : &lt;PageNotFound /&gt;</span>
<span class="token inserted">+         }</span>
        &lt;/PageViewDispatcher&gt;
      }
    &lt;/ProductViewLoader&gt;
  &lt;/ViewRoute&gt;
</code></pre></div><div class="language-diff extra-class"><pre class="language-diff"><code>  ...

  ProductViewLoader.loadPromisedProps = (props) =&gt;
    loadProduct(props.id, props.fallbackTov1).then((product) =&gt; {
      const vertical = product.isUnisex ? props.uiVertical : product.vertical
      props.uiVertical !== vertical &amp;&amp; props.viewRouteUpdate({ vertical })
      return { product }
<span class="token deleted">-   })</span>
<span class="token inserted">+   }).catch(() =&gt;</span>
<span class="token inserted">+     ({})</span>
<span class="token inserted">+   )</span>

  ...
</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/zakness/birchbox-vuepress/edit/vuepress/docs/guides/routing/writing-routehook.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/14/2019, 10:39:48 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/birchbox-vuepress/assets/js/app.a6b284a8.js" defer></script><script src="/birchbox-vuepress/assets/js/100.e3eed064.js" defer></script>
  </body>
</html>
